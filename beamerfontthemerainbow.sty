\RequirePackage{iftex}
\RequirePackage{fontawesome5}
\RequirePackage{relsize}

\newif\ifrainbow@fonthasoptions%
% \newcommand*\rainbow@checkfonth@soptionstrue[2][]{%
% 	\rainbow@fonthasoptionstrue%
% }
% \newcommand*\rainbow@checkfonth@soptionsfalse[1]{%
% 	\rainbow@fonthasoptionsfalse%
% }
\newcommand*\rainbow@checkfonthasoptions[1]{%
\message{#1}%
\IfBeginWith{#1}{[}{%
\rainbow@fonthasoptionstrue%
}{%
\rainbow@fonthasoptionsfalse%
}
% \expandafter\@ifnextchar\expandafter[%
% \expandafter\rainbow@checkfonth@soptionstrue%
% \expandafter\rainbow@checkfonth@soptionsfalse#1%
}

\ifPDFTeX%
	\PackageError{rainbow}{PDFTeX is unsupported (at least for now) since our template needs to load some fonts.}{}
\else%
	\RequirePackage[
		warnings-off={mathtools-colon,mathtools-overbracket}
	]{unicode-math}
	\RequirePackage{fontspec}

	\IfStrEq{\rainbow@fonts@main}{\@empty}{%
		%% If no custom main font has been requested
		\setmainfont[
			Path = {\rainbow@path fonts/Yanone_Kaffeesatz/},
			UprightFeatures={
					LetterSpace=4.2,
					Weight=400,
				},
			BoldFont            =   *,
			BoldFeatures={
					LetterSpace=4.2,
					Weight=900,
				},
			ItalicFont = *,
			ItalicFeatures={
					LetterSpace=4.2,
					Slant=-5
				}
		]{YanoneKaffeesatz-VariableFont_wght.ttf}
	}{%
		\rainbow@checkfonthasoptions{\rainbow@fonts@main}%
		\ifrainbow@fonthasoptions%
			\expandafter\setmainfont\rainbow@fonts@main%
		\else%
			\setmainfont{\rainbow@fonts@main}%
		\fi%
	}

	\IfStrEq{\rainbow@fonts@sans}{\@empty}{%
		%% If no custom sans font has been requested
		\IfFileExists{andika.sty}{%
			\usepackage{andika}
			% NOTE: Automatically changes the sans font
			\setsansfont{Andika}
		}{%
			\setsansfont[
				Path           = {\rainbow@path fonts/Andika/},
				Extension      = .ttf,
				Ligatures      = TeX,
				UprightFont    = *-Regular,
				BoldFont       = *-Bold,
				ItalicFont     = *-Italic,
				BoldItalicFont = *-BoldItalic
			]{Andika}
		}
	}{%
		\rainbow@checkfonthasoptions{\rainbow@fonts@sans}%
		\ifrainbow@fonthasoptions%
			\expandafter\setsansfont\rainbow@fonts@sans%
		\else%
			\setsansfont{\rainbow@fonts@sans}%
		\fi%
	}

	\IfStrEq{\rainbow@fonts@mono}{\@empty}{%
		%% If no custom mono font has been requested
		\setmonofont[
			Path           = {\rainbow@path fonts/IosevkaCustom/},
			Extension      = .ttf,
			UprightFont    = *-Regular,
			ItalicFont     = *-Italic,
			BoldFont       = *-Bold,
			BoldItalicFont = *-BoldItalic
		]{IosevkaCustom}
	}{%
		\rainbow@checkfonthasoptions{\rainbow@fonts@mono}%
		\ifrainbow@fonthasoptions%
			\expandafter\setmonofont\rainbow@fonts@mono%
		\else%
			\setmonofont{\rainbow@fonts@mono}%
		\fi%
	}

	\IfStrEq{\rainbow@fonts@math}{\@empty}{%
		%% If no custom math font has been requested
		\IfFileExists{lete-sans-math.sty}{%
			\RequirePackage{lete-sans-math}
			% NOTE: automatically changes the math font
			\setmathfont{Lete Sans Math}
		}{%
			\setmathfont[
				Path = {\rainbow@path fonts/LeteSansMath/},
				% Extension = .otf, 
				UprightFont = *,
				% BoldFont = *-Bold,
			]{LeteSansMath.otf}
		}
	}{%
		\rainbow@checkfonthasoptions{\rainbow@fonts@math}%
		\ifrainbow@fonthasoptions%
			\expandafter\setmathfont\rainbow@fonts@math%
		\else%
			\setmathfont{\rainbow@fonts@math}%
		\fi%
	}
\fi

\setbeamerfont*{structure}{family=\rmfamily}%,series=\bfseries\boldmath}

\setbeamerfont*{frametitle}{size=\Large,parent=structure}
\setbeamerfont*{framesubtitle}{size=\large,parent=frametitle}

\setbeamerfont*{footline}{size=\tiny, series=\bfseries, family=\sffamily}

\setbeamerfont*{title}{size=\LARGE, family=\sffamily}
\setbeamerfont*{subtitle}{size=\normalsize, family=\sffamily}
\setbeamerfont*{author}{size=\large, family=\rmfamily}
\setbeamerfont*{titlepage date}{size=\normalfont, family=\rmfamily}

\setbeamerfont*{section in toc}{parent=structure}
\setbeamerfont*{subsection in toc}{parent=structure}

\setbeamerfont*{itemize item}{parent=structure, series=\bfseries\boldmath}
\setbeamerfont*{enumerate item}{parent=structure, series=\bfseries\boldmath}

\setbeamerfont*{block title}{family=\rmfamily, size=\normalsize}
\setbeamerfont*{block title example}{family=\rmfamily, size=\normalsize}
\setbeamerfont*{block title alerted}{family=\rmfamily, size=\normalsize}
\setbeamerfont*{block body}{size=\small}
\setbeamerfont*{block body example}{size=\small}
\setbeamerfont*{block body alerted}{size=\small}

\setbeamerfont*{itemize item}{parent=structure, series=\bfseries\boldmath}
\setbeamerfont*{enumerate item}{parent=structure, series=\bfseries\boldmath}

\setbeamerfont*{qed symbol}{size=\footnotesize, series=\boldmath}

\BeforeBeginEnvironment{lemma}{%
	\let\theoremicon\faCheckCircle%
}
\BeforeBeginEnvironment{theorem}{%
	\let\theoremicon\faCheckCircle%
}
\BeforeBeginEnvironment{definition}{%
	\let\theoremicon\faCrosshairs%
}

\setbeamerfont*{button}{size=\scriptsize, family=\rmfamily}
\renewcommand\insertgotosymbol{{\smaller\faShare}\ \ }
\renewcommand\insertskipsymbol{{\smaller\faAngleDoubleRight}\ \ }
\renewcommand\insertreturnsymbol{{\smaller\faReply}\ \ }